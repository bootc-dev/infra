{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    // Base configuration
    "config:recommended",
    // Add "Signed-off-by" footer to commit messages
    ":gitSignOff",
    // Catch-all for grouping dependencies not caught by other groups
    "group:all",
    ":preserveSemverRanges"
  ],
  // Clone git submodules when analyzing repositories
  //
  // Some repositories use git submodules for vendored dependencies that are
  // referenced in Cargo.toml files. Without initializing submodules, Renovate
  // will fail to analyze these dependencies.
  "cloneSubmodules": true,
  // Custom managers for detecting dependencies in non-standard files
  //
  // - Containerfile/Dockerfile: Match "# renovate:" comments with ARG statements
  // - .txt files: Match "# renovate:" comments followed by package@version on next line
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["(^|/)Containerfile$", "(^|/)Dockerfile$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+)\\s+ARG \\w+version=(?<currentValue>.+)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": ["**/*.txt"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+)\\n.*@(?<currentValue>\\S+)"
      ]
    },
    // Shell scripts in GHA workflows/actions: Match "# renovate:" followed by VERSION=
    {
      "customType": "regex",
      "managerFilePatterns": ["**/*.yml", "**/*.yaml"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>[a-z-]+) depName=(?<depName>[^\\s]+)\\n\\s*VERSION=(?<currentValue>v?\\S+)"
      ]
    },
    // Git refs (commit SHA) tracking in Justfiles and YAML workflows
    // Justfile example:
    //   # renovate: datasource=git-refs depName=https://github.com/org/repo branch=main
    //   export VAR := env("VAR", "0000000000000000000000000000000000000000")
    // YAML example:
    //   # renovate: datasource=git-refs depName=https://github.com/org/repo branch=main
    //   VAR: '0000000000000000000000000000000000000000'
    {
      "customType": "regex",
      "managerFilePatterns": ["**/Justfile", "**/*.just", "**/*.yml", "**/*.yaml"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>git-refs) depName=(?<depName>[^\\s]+) branch=(?<currentValue>[^\\s]+)\\n[^\\n]*\"(?<currentDigest>[a-f0-9]{40})\"",
        "# renovate: datasource=(?<datasource>git-refs) depName=(?<depName>[^\\s]+) branch=(?<currentValue>[^\\s]+)\\n[^\\n]*'(?<currentDigest>[a-f0-9]{40})'"
      ]
    }
  ],
  "packageRules": [
    // Limit dependency updates to once per week to reduce PR churn
    //
    // Rapidly-updating dependencies (e.g., opencode-ai) can create excessive PRs.
    // By scheduling updates to Sundays only, we get one PR per week with the
    // latest version, skipping all intermediate releases.
    //
    // Exception: bcvk updates immediately (excluded via negated regex).
    {
      "description": ["Limit dependency updates to weekly (Sundays UTC) to reduce PR churn. bcvk is excluded and updates immediately."],
      "matchPackageNames": ["!/^bcvk$/"],
      "schedule": ["on sunday"],
      "timezone": "UTC"
    },
    {
    // These files in these repos are synced from the bootc-dev/infra repository, which
    // sends PRs to update them. Ignoring them here to avoid conflicting Renovate updates.
      "matchRepositories": [
        "bootc-dev/bootc",
        "bootc-dev/bcvk",
        "bootc-dev/ci-sandbox",
        "bootc-dev/containers-image-proxy-rs",
        "bootc-dev/bootc-dev.github.io"
      ],
      "ignorePaths": [
        ".github/workflows/rebase.yml",
        ".github/workflows/openssf-scorecard.yml",
        ".github/actions/bootc-ubuntu-setup/action.yml",
        ".github/actions/setup-rust/action.yml"
      ]
    },
    // Group GitHub Actions dependencies
    {
      "description": ["GitHub Actions dependencies"],
      "matchManagers": [
        "github-actions"
      ],
      "groupName": "GitHub Actions",
      "enabled": true
    },
    // Group Rust dependencies
    {
      "description": ["Rust dependencies"],
      "matchManagers": [
        "cargo"
      ],
      "groupName": "Rust",
      "enabled": true
    },
    // Group Docker dependencies
    {
      "description": ["Docker dependencies"],
      "matchManagers": [
        "dockerfile",
        "custom.regex"
      ],
      "groupName": "Docker",
      "enabled": true
    },
    // Group npm dependencies
    {
      "description": ["npm dependencies"],
      "matchDatasources": ["npm"],
      "groupName": "npm",
      "enabled": true
    },
    // Disable Containerfile digest pinning
    {
      "description": ["Containerfile digest pinning"],
      "matchManagers": [
        "dockerfile"
      ],
      "pinDigests": false
    },
    // Disable Fedora OCI updates
    //
    // This is due to there not being an easy way to tell Renovate which
    // Fedora version is "stable" and which has not been released yet.
    {
      "description": ["Disable Fedora OCI updates"],
      "matchManagers": [
        "dockerfile",
        "github-actions"
      ],
      "matchDepNames": [
        "quay.io/fedora/fedora",
        "quay.io/fedora/fedora-bootc"
      ],
      "enabled": false
    },
    // Ignore bootc cargo dependencies to fix failing Renovate task
    // See: https://github.com/bootc-dev/infra/actions/runs/19914695687
    {
      "matchManagers": ["cargo"],
      "matchPackageNames": [
        "composefs",
        "composefs-boot",
        "composefs-oci"
      ],
      "enabled": false
    }
  ]
}
